<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #e9e5f3; 
            background-image: url("https://www.transparenttextures.com/patterns/food.png"); 
            color: #334155; 
        }
        .app-section { background-color: #fcfaf2; border-radius: 20px; padding: 24px; border: 1px solid #f0ede4; transition: all 0.3s ease; }
        .drag-row { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 8px; margin-bottom: 4px; transition: all 0.2s; }
        .sortable-ghost { opacity: 0.1; background: #a78bfa !important; }
        .drag-handle { cursor: grab; color: #d1d5db; padding: 4px; }
        
        .section-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
        }
        .section-collapsed {
            max-height: 0;
            opacity: 0;
            pointer-events: none;
        }

        /* Polaroid Image Style */
        .photo-card {
            aspect-ratio: 1/1;
            background: white;
            padding: 10px 10px 30px 10px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            transform: rotate(-1deg);
            transition: transform 0.2s;
        }
        .photo-card:hover { transform: rotate(0deg) scale(1.02); }

        @media print {
            .no-print { display: none !important; }
            .section-collapsed { max-height: none !important; opacity: 1 !important; }
            .card { box-shadow: none !important; border: none !important; padding: 0 !important; background: white !important; }
            body { background: white !important; }
            .app-section { background: white !important; border: none !important; padding: 0 !important; }
        }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-[1550px] mx-auto p-6 md:p-10">
    <div class="flex flex-wrap justify-between items-center mb-8 gap-4 no-print bg-white/90 backdrop-blur-md p-5 rounded-2xl shadow-xl border border-white/50">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-4">
                <button @click="saveRecipe" class="hover:text-purple-600 transition-colors" title="Save File"><i class="ph ph-floppy-disk text-2xl"></i></button>
                <button @click="$refs.fileInput.click()" class="hover:text-purple-600 transition-colors" title="Load File"><i class="ph ph-folder-open text-2xl"></i></button>
                
                <div class="relative inline-block ml-2">
                    <select @change="fetchGitHubRecipe($event.target.value)" class="appearance-none bg-purple-50 border-none rounded-lg py-1.5 pl-3 pr-8 text-sm font-bold text-purple-700 cursor-pointer focus:ring-2 focus:ring-purple-300">
                        <option value="" disabled selected>ðŸ“œ Online Recipes</option>
                        <option v-for="file in githubRecipes" :key="file.path" :value="file.download_url">
                            {{ file.name.replace('.json', '') }}
                        </option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-purple-700">
                        <i class="ph ph-caret-down"></i>
                    </div>
                </div>

                <input type="file" ref="fileInput" @change="loadRecipe" accept=".json" class="hidden">
            </div>
            <div class="h-8 w-px bg-slate-200"></div>
            
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <span class="text-[10px] uppercase font-bold text-slate-400">Scale Yield</span>
                    <div class="relative inline-block">
                        <select v-model="scale" class="appearance-none bg-slate-100 border-none rounded-lg py-1 pl-3 pr-8 text-sm font-bold text-purple-700 cursor-pointer focus:ring-2 focus:ring-purple-300">
                            <optgroup label="Scaling Down">
                                <option :value="0.25">1/4 (0.25x)</option>
                                <option :value="0.33">1/3 (0.33x)</option>
                                <option :value="0.5">1/2 (0.5x)</option>
                            </optgroup>
                            <optgroup label="Standard">
                                <option :value="1">Full (1x)</option>
                            </optgroup>
                            <optgroup label="Scaling Up">
                                <option :value="2">2x</option>
                                <option :value="3">3x</option>
                                <option :value="4">4x</option>
                                <option :value="5">5x</option>
                            </optgroup>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-purple-700">
                            <i class="ph ph-caret-down"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <div class="flex gap-2 mr-4">
                <button @click="toggleAll(false)" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" title="Collapse All"><i class="ph ph-arrows-in-simple text-xl text-slate-400"></i></button>
                <button @click="toggleAll(true)" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" title="Expand All"><i class="ph ph-arrows-out-simple text-xl text-slate-400"></i></button>
            </div>
            <div class="flex bg-slate-100 p-1 rounded-lg">
                <button @click="unitSystem = 'metric'" :class="unitSystem === 'metric' ? 'bg-white shadow-sm text-purple-600' : 'text-slate-500'" class="px-4 py-1.5 rounded-md text-sm font-bold transition-all">Metric</button>
                <button @click="unitSystem = 'imperial'" :class="unitSystem === 'imperial' ? 'bg-white shadow-sm text-purple-600' : 'text-slate-500'" class="px-4 py-1.5 rounded-md text-sm font-bold transition-all">Imperial</button>
            </div>
            <button onclick="window.print()" class="ml-4 p-2 hover:bg-white rounded-full transition-colors"><i class="ph ph-printer text-2xl text-slate-400 hover:text-black"></i></button>
        </div>
    </div>

    <div class="card bg-white shadow-2xl rounded-[40px] p-10 md:p-16 border border-white/50 relative overflow-hidden">
        
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-12">
            <div class="relative no-print group">
                <div class="w-20 h-20 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-500 text-4xl shadow-inner">
                    <i :class="categories.find(c => c.name === selectedCategory).icon"></i>
                </div>
                <select v-model="selectedCategory" class="absolute inset-0 opacity-0 cursor-pointer">
                    <option v-for="cat in categories" :key="cat.name" :value="cat.name">{{ cat.name }}</option>
                </select>
            </div>
            <div class="flex flex-col flex-grow">
                <span class="text-purple-400 font-bold uppercase tracking-[0.2em] text-xs ml-1">Recipe for...</span>
                <input v-model="recipeTitle" placeholder="Untitled Recipe" class="text-5xl font-black w-full focus:outline-none border-b-2 border-transparent focus:border-purple-300 pb-2 transition-all bg-transparent">
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div class="space-y-10">
                
                <div class="grid grid-cols-2 gap-6">
                    <div class="photo-card relative group cursor-pointer" @click="$refs.photoInput.click()">
                        <div class="w-full h-full bg-slate-50 rounded-sm overflow-hidden flex items-center justify-center">
                            <img v-if="recipeImage" :src="recipeImage" class="w-full h-full object-cover">
                            <div v-else class="text-slate-300 flex flex-col items-center">
                                <i class="ph ph-camera text-4xl"></i>
                                <span class="text-[10px] font-bold mt-2">ADD PHOTO</span>
                            </div>
                        </div>
                        <input type="file" ref="photoInput" @change="handleImage" accept="image/*" class="hidden">
                    </div>
                    
                    <div class="flex flex-col justify-center gap-4">
                        <div class="bg-purple-50 p-4 rounded-2xl">
                            <span class="text-[10px] font-black uppercase text-purple-400 block mb-1">Prep Time</span>
                            <input v-model="prepTime" placeholder="20 mins" class="bg-transparent font-bold text-purple-700 outline-none w-full">
                        </div>
                        <div class="bg-orange-50 p-4 rounded-2xl">
                            <span class="text-[10px] font-black uppercase text-orange-400 block mb-1">Cook Time</span>
                            <input v-model="cookTime" placeholder="45 mins" class="bg-transparent font-bold text-orange-700 outline-none w-full">
                        </div>
                    </div>
                </div>

                <section class="app-section">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-3 cursor-pointer group" @click="ui.showIng = !ui.showIng">
                        <div class="flex items-center gap-3">
                            <i class="ph text-xl text-purple-400 transition-transform" :class="ui.showIng ? 'ph-caret-down' : 'ph-caret-right'"></i>
                            <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Ingredients</h2>
                        </div>
                        <button v-show="ui.showIng" @click.stop="addIngredient" class="text-purple-600 text-xs font-black no-print hover:underline">+ ADD ITEM</button>
                    </div>
                    <div :class="{'section-collapsed': !ui.showIng}" class="section-content">
                        <div id="ingredient-list">
                            <div v-for="(ing, index) in ingredients" :key="ing.id" class="drag-row group">
                                <i class="ph ph-dots-six-vertical drag-handle text-xl no-print"></i>
                                <div class="w-20 text-right font-mono font-bold text-lg text-purple-600">
                                    {{ isQualitative(ing.unit) ? '' : calculateAmount(ing.amount, ing.unit) }}
                                </div>
                                <div :class="isQualitative(ing.unit) ? 'w-36' : 'w-16'" class="text-sm font-black text-slate-800 uppercase">
                                    {{ getDisplayUnit(ing.unit) }}
                                </div>
                                <input v-model="ing.name" placeholder="Ingredient..." class="flex-grow text-base outline-none bg-transparent border-b border-transparent focus:border-purple-200">
                                <div class="flex items-center gap-2 no-print opacity-0 group-hover:opacity-100 transition-opacity">
                                    <select v-model="ing.unit" class="text-[10px] font-bold bg-white border rounded p-1 uppercase">
                                        <optgroup label="Measurements"><option v-for="u in ['g','kg','ml','l','cup','tbsp','tsp','pcs']" :value="u">{{u}}</option></optgroup>
                                        <optgroup label="Qualitative"><option value="pinch">Pinch</option><option value="to taste">To Taste</option><option value="a bit">A Bit</option></optgroup>
                                    </select>
                                    <input v-if="!isQualitative(ing.unit)" type="number" step="any" v-model.number="ing.amount" class="w-12 text-[10px] text-center border bg-white rounded p-1">
                                    <button @click="ingredients.splice(index, 1)" class="text-red-300 hover:text-red-500"><i class="ph ph-trash text-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="space-y-10">
                <section class="app-section">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-3 cursor-pointer group" @click="ui.showIns = !ui.showIns">
                        <div class="flex items-center gap-3">
                            <i class="ph text-xl text-purple-400 transition-transform" :class="ui.showIns ? 'ph-caret-down' : 'ph-caret-right'"></i>
                            <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Method</h2>
                        </div>
                        <button v-show="ui.showIns" @click.stop="addInstruction" class="text-purple-600 text-xs font-black no-print hover:underline">+ ADD STEP</button>
                    </div>
                    <div :class="{'section-collapsed': !ui.showIns}" class="section-content">
                        <div id="instruction-list">
                            <div v-for="(ins, index) in instructions" :key="ins.id" class="drag-row group items-start">
                                <i class="ph ph-dots-six-vertical drag-handle text-xl no-print mt-1"></i>
                                <div class="flex flex-col gap-1 flex-grow">
                                    <input v-model="ins.title" placeholder="Step Title (Optional)" class="text-xs font-black text-purple-400 uppercase tracking-widest focus:outline-none bg-transparent">
                                    <textarea v-model="ins.text" placeholder="Explain what to do..." class="w-full text-base outline-none bg-transparent resize-none overflow-hidden" rows="2" @input="e => {e.target.style.height='auto'; e.target.style.height=e.target.scrollHeight+'px'}"></textarea>
                                </div>
                                <button @click="instructions.splice(index, 1)" class="text-red-300 hover:text-red-500 no-print opacity-0 group-hover:opacity-100 transition-opacity"><i class="ph ph-trash text-lg"></i></button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="app-section">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-200 pb-3 cursor-pointer" @click="ui.showNotes = !ui.showNotes">
                        <i class="ph text-xl text-purple-400 transition-transform" :class="ui.showNotes ? 'ph-caret-down' : 'ph-caret-right'"></i>
                        <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Chef's Notes</h2>
                    </div>
                    <div :class="{'section-collapsed': !ui.showNotes}" class="section-content">
                        <textarea v-model="chefNotes" placeholder="Any extra tips or variations..." class="w-full bg-transparent text-slate-600 italic outline-none min-h-[100px] resize-none"></textarea>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                recipeTitle: '',
                selectedCategory: 'Main',
                recipeImage: null,
                prepTime: '',
                cookTime: '',
                chefNotes: '',
                scale: 1,
                unitSystem: 'metric',
                githubRecipes: [],
                repoPath: 'https://api.github.com/repos/icheong/my-recipes/contents/recipes',
                categories: [
                    { name: 'Breakfast', icon: 'ph-coffee' },
                    { name: 'Main', icon: 'ph-bowl-food' },
                    { name: 'Dessert', icon: 'ph-cookie' },
                    { name: 'Drinks', icon: 'ph-wine' }
                ],
                ingredients: [
                    { id: Date.now(), name: 'Example Ingredient', amount: 100, unit: 'g' }
                ],
                instructions: [
                    { id: Date.now() + 1, title: 'First Step', text: 'Start cooking here...' }
                ],
                ui: {
                    showIng: true,
                    showIns: true,
                    showNotes: true
                }
            }
        },
        mounted() {
            this.initSortable('ingredient-list', 'ingredients');
            this.initSortable('instruction-list', 'instructions');
            this.listGitHubRecipes();
        },
        methods: {
            async listGitHubRecipes() {
                try {
                    const response = await fetch(this.repoPath);
                    const files = await response.json();
                    if (Array.isArray(files)) {
                        this.githubRecipes = files.filter(file => file.name.endsWith('.json'));
                    }
                } catch (error) {
                    console.error("Error fetching recipe list:", error);
                }
            },
            async fetchGitHubRecipe(url) {
                if (!url) return;
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    Object.assign(this, data);
                    this.scale = 1; // Reset scale on load
                } catch (error) {
                    alert("Failed to load recipe from GitHub.");
                    console.error(error);
                }
            },
            initSortable(id, listName) {
                new Sortable(document.getElementById(id), {
                    animation: 150,
                    handle: '.drag-handle',
                    ghostClass: 'sortable-ghost',
                    onEnd: (evt) => {
                        const item = this[listName].splice(evt.oldIndex, 1)[0];
                        this[listName].splice(evt.newIndex, 0, item);
                    }
                });
            },
            handleImage(e) {
                const reader = new FileReader();
                reader.onload = (event) => this.recipeImage = event.target.result;
                reader.readAsDataURL(e.target.files[0]);
            },
            addIngredient() {
                this.ingredients.push({ id: Date.now(), name: '', amount: 0, unit: 'g' });
            },
            addInstruction() {
                this.instructions.push({ id: Date.now(), title: '', text: '' });
            },
            toggleAll(show) {
                this.ui.showIng = show;
                this.ui.showIns = show;
                this.ui.showNotes = show;
            },
            saveRecipe() {
                const data = JSON.stringify({
                    recipeTitle: this.recipeTitle,
                    selectedCategory: this.selectedCategory,
                    recipeImage: this.recipeImage,
                    prepTime: this.prepTime,
                    cookTime: this.cookTime,
                    chefNotes: this.chefNotes,
                    ingredients: this.ingredients,
                    instructions: this.instructions
                }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${this.recipeTitle || 'recipe'}.json`;
                link.click();
            },
            loadRecipe(e) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const data = JSON.parse(event.target.result);
                    Object.assign(this, data);
                };
                reader.readAsText(e.target.files[0]);
            },
            isQualitative(unit) {
                return ['pinch', 'to taste', 'a bit', 'pcs'].includes(unit);
            },
            getDisplayUnit(unit) {
                if (this.unitSystem === 'metric') return unit;
                const conv = { 'g': 'oz', 'kg': 'lb', 'ml': 'fl oz', 'l': 'gal' };
                return conv[unit] || unit;
            },
            formatToFraction(val) {
                if (val === 0) return '';
                if (Math.abs(val - Math.round(val)) < 0.01) return Math.round(val);
                const whole = Math.floor(val);
                const remainder = val - whole;
                const fracs = [{d:0.5,s:"1/2"},{d:0.25,s:"1/4"},{d:0.75,s:"3/4"},{d:0.33,s:"1/3"},{d:0.66,s:"2/3"},{d:0.125,s:"1/8"}];
                const match = fracs.find(f => Math.abs(remainder - f.d) < 0.03);
                if (match) return whole > 0 ? `${whole} ${match.s}` : match.s;
                return parseFloat(val.toFixed(2));
            },
            calculateAmount(base, unit) {
                let val = (parseFloat(base) || 0) * this.scale;
                if (this.unitSystem === 'imperial') {
                    if (unit === 'g') val *= 0.035274;
                    if (unit === 'kg') val *= 2.20462;
                    if (unit === 'ml') val *= 0.033814;
                    if (unit === 'l') val *= 0.264172;
                }
                return this.formatToFraction(val);
            }
        }
    }).mount('#app');
</script>

</body>
</html>
