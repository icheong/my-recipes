<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #e9e5f3; 
            background-image: url("https://www.transparenttextures.com/patterns/food.png"); 
            color: #334155; 
        }
        .app-section { background-color: #fcfaf2; border-radius: 20px; padding: 24px; border: 1px solid #f0ede4; transition: all 0.3s ease; }
        .drag-row { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 8px; margin-bottom: 4px; transition: all 0.2s; }
        .sortable-ghost { opacity: 0.1; background: #a78bfa !important; }
        .drag-handle { cursor: grab; color: #d1d5db; padding: 4px; }
        
        .section-content { max-height: 2000px; overflow: hidden; transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease; }
        .section-collapsed { max-height: 0; opacity: 0; pointer-events: none; }

        .photo-card {
            aspect-ratio: 1/1; background: white; padding: 10px 10px 30px 10px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); transform: rotate(-1deg); transition: transform 0.2s;
        }
        .photo-card:hover { transform: rotate(0deg) scale(1.02); }

        @media print {
            .no-print { display: none !important; }
            .section-collapsed { max-height: none !important; opacity: 1 !important; }
            .card { box-shadow: none !important; border: none !important; padding: 0 !important; background: white !important; }
            body { background: white !important; }
            .app-section { background: white !important; border: none !important; padding: 0 !important; }
        }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-[1550px] mx-auto p-6 md:p-10">
    <div class="flex flex-wrap justify-between items-center mb-8 gap-4 no-print bg-white/90 backdrop-blur-md p-5 rounded-2xl shadow-xl border border-white/50">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-4">
                <button @click="saveRecipe" class="hover:text-purple-600 transition-colors" title="Download JSON"><i class="ph ph-floppy-disk text-2xl"></i></button>
                <button @click="$refs.fileInput.click()" class="hover:text-purple-600 transition-colors" title="Load from Computer"><i class="ph ph-folder-open text-2xl"></i></button>
                <button @click="toggleLibrary" class="hover:text-purple-600 transition-colors flex items-center gap-1" title="Recipe Library">
                    <i class="ph ph-books text-2xl"></i>
                    <span class="text-xs font-bold uppercase">Library</span>
                </button>
                <input type="file" ref="fileInput" @change="loadRecipe" accept=".json" class="hidden">
            </div>
            
            <div v-if="ui.showLibraryMenu" class="absolute top-24 z-50 bg-white shadow-2xl rounded-xl border p-4 w-64 animate-in fade-in slide-in-from-top-2">
                <h3 class="text-xs font-black uppercase text-slate-400 mb-3 tracking-widest">Saved Recipes</h3>
                <div v-if="loadingLibrary" class="text-sm py-2">Loading...</div>
                <div v-else class="space-y-1">
                    <button v-for="r in library" @click="fetchFromGithub(r.path)" class="w-full text-left p-2 hover:bg-purple-50 rounded text-sm font-medium transition-colors">
                        {{ r.name }}
                    </button>
                    <div v-if="library.length === 0" class="text-xs text-slate-400">No recipes in manifest.</div>
                </div>
            </div>

            <div class="h-8 w-px bg-slate-200"></div>
            
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <span class="text-[10px] uppercase font-bold text-slate-400">Scale Yield</span>
                    <select v-model="scale" class="bg-slate-100 border-none rounded-lg py-1 px-2 text-sm font-bold text-purple-700">
                        <option :value="0.5">0.5x</option>
                        <option :value="1">1x</option>
                        <option :value="2">2x</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <div class="flex bg-slate-100 p-1 rounded-lg">
                <button @click="unitSystem = 'metric'" :class="unitSystem === 'metric' ? 'bg-white shadow-sm text-purple-600' : 'text-slate-500'" class="px-4 py-1.5 rounded-md text-sm font-bold">Metric</button>
                <button @click="unitSystem = 'imperial'" :class="unitSystem === 'imperial' ? 'bg-white shadow-sm text-purple-600' : 'text-slate-500'" class="px-4 py-1.5 rounded-md text-sm font-bold">Imperial</button>
            </div>
            <button onclick="window.print()" class="ml-4 p-2 hover:bg-white rounded-full transition-colors"><i class="ph ph-printer text-2xl"></i></button>
        </div>
    </div>

    <div class="card bg-white shadow-2xl rounded-[40px] p-10 md:p-16 border border-white/50 relative overflow-hidden">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-12">
            <div class="relative no-print group">
                <div class="w-20 h-20 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-500 text-4xl shadow-inner">
                    <i :class="categories.find(c => c.name === selectedCategory)?.icon || 'ph ph-cooking-pot'"></i>
                </div>
                <select v-model="selectedCategory" class="absolute inset-0 opacity-0 cursor-pointer">
                    <option v-for="cat in categories" :key="cat.name" :value="cat.name">{{ cat.name }}</option>
                </select>
            </div>
            <div class="flex flex-col">
                <span class="text-purple-400 font-bold uppercase tracking-[0.2em] text-xs ml-1">Recipe for...</span>
                <input v-model="recipeTitle" placeholder="Untitled Recipe" class="text-5xl font-black w-full focus:outline-none border-b-2 border-transparent focus:border-purple-300 pb-2 transition-all bg-transparent">
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div class="space-y-10">
                <section class="app-section">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-3">
                        <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Ingredients</h2>
                        <button @click="addIngredient" class="text-purple-600 text-xs font-black no-print">+ ADD ITEM</button>
                    </div>
                    <div id="ingredient-list">
                        <div v-for="(ing, index) in ingredients" :key="ing.id" class="drag-row group">
                            <i class="ph ph-dots-six-vertical drag-handle text-xl no-print"></i>
                            <div class="w-20 text-right font-mono font-bold text-lg text-purple-600">{{ isQualitative(ing.unit) ? '' : calculateAmount(ing.amount, ing.unit) }}</div>
                            <div class="w-16 text-sm font-black text-slate-800 uppercase">{{ getDisplayUnit(ing.unit) }}</div>
                            <input v-model="ing.name" placeholder="Ingredient..." class="flex-grow text-base outline-none bg-transparent">
                            <button @click="ingredients.splice(index, 1)" class="no-print opacity-0 group-hover:opacity-100 text-red-300"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                </section>

                <section class="app-section">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-3">
                        <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Gallery</h2>
                        <button @click="$refs.imageInput.click()" class="text-purple-600 text-xs font-black no-print">+ ADD PHOTO</button>
                        <input type="file" ref="imageInput" multiple accept="image/*" class="hidden" @change="handleImageUpload">
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div v-for="(img, index) in images" :key="index" class="relative group">
                            <div class="photo-card">
                                <img :src="img" class="w-full h-full object-cover">
                            </div>
                            <button @click="images.splice(index, 1)" class="no-print absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class="ph ph-x"></i>
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <section class="app-section">
                <div class="flex justify-between items-center mb-6 border-b border-slate-200 pb-3">
                    <h2 class="text-xs font-black uppercase tracking-widest text-slate-400">Method</h2>
                    <button @click="addMethod" class="text-purple-600 text-xs font-black no-print">+ ADD STEP</button>
                </div>
                <div id="method-list">
                    <div v-for="(step, index) in method" :key="step.id" class="flex gap-4 mb-6 group items-start">
                        <i class="ph ph-dots-six-vertical drag-handle text-xl mt-3 no-print"></i>
                        <span class="text-3xl font-black text-slate-200 mt-1 w-8">{{ index + 1 }}</span>
                        <textarea v-model="step.text" rows="2" class="flex-grow text-base leading-relaxed p-4 bg-white/50 rounded-xl focus:bg-white outline-none resize-none"></textarea>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<script>
const { createApp, nextTick } = Vue;

// CHANGE THESE TO YOUR GITHUB DETAILS
const GITHUB_USERNAME = 'icheong'; 
const REPO_NAME = 'my-recipes';

createApp({
    data() {
        return {
            recipeTitle: '',
            scale: 1,
            unitSystem: 'metric',
            selectedCategory: 'Mains',
            library: [],
            loadingLibrary: false,
            ui: { showLibraryMenu: false },
            categories: [
                { name: 'Cakes', icon: 'ph ph-cake' }, { name: 'Mains', icon: 'ph ph-cooking-pot' },
                { name: 'Baking', icon: 'ph ph-bread' }, { name: 'Sandwiches', icon: 'ph ph-hamburger' }
            ],
            ingredients: [{ id: 1, amount: 0, unit: 'g', name: '' }],
            method: [{ id: 3, text: '' }],
            images: [],
            notes: ''
        }
    },
    methods: {
        toggleLibrary() {
            this.ui.showLibraryMenu = !this.ui.showLibraryMenu;
            if (this.ui.showLibraryMenu) this.fetchManifest();
        },
        async fetchManifest() {
            this.loadingLibrary = true;
            try {
                // Fetching the recipes.json from your GitHub
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/recipes.json`);
                this.library = await response.json();
            } catch (e) {
                console.error("Library load failed", e);
                alert("Could not load manifest. Check GITHUB_USERNAME in the code.");
            } finally {
                this.loadingLibrary = false;
            }
        },
        async fetchFromGithub(path) {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${path}`);
                const data = await response.json();
                Object.assign(this, data);
                this.ui.showLibraryMenu = false;
            } catch (e) {
                alert("Error loading recipe file.");
            }
        },
        saveRecipe() {
            const data = JSON.stringify(this.$data);
            const blob = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${this.recipeTitle.toLowerCase().replace(/\s+/g, '_') || 'recipe'}.json`;
            a.click();
        },
        loadRecipe(e) {
            const reader = new FileReader();
            reader.onload = (event) => Object.assign(this, JSON.parse(event.target.result));
            reader.readAsText(e.target.files[0]);
        },
        handleImageUpload(e) {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => this.images.push(ev.target.result);
                reader.readAsDataURL(file);
            });
        },
        addIngredient() { this.ingredients.push({ id: Date.now(), amount: 0, unit: 'g', name: '' }); },
        addMethod() { this.method.push({ id: Date.now(), text: '' }); },
        isQualitative(unit) { return ['pinch', 'to taste'].includes(unit); },
        calculateAmount(base, unit) {
            let val = (parseFloat(base) || 0) * this.scale;
            return val === 0 ? '' : val.toFixed(1).replace('.0', '');
        },
        getDisplayUnit(unit) { return unit; }
    }
}).mount('#app');
</script>
</body>
</html>
