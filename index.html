<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        [v-cloak] { display: none; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #e9e5f3; 
            background-image: url("https://www.transparenttextures.com/patterns/food.png"); 
            color: #334155; 
        }
        .app-section { background-color: #fcfaf2; border-radius: 20px; padding: 24px; border: 1px solid #f0ede4; }
        
        /* The Fix: Fixed positioning relative to the viewport ensures it is never hidden */
        .library-dropdown {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            width: 320px;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(4px);
        }

        .card { 
            /* Removed overflow: hidden to prevent clipping */
            background: white; 
            border-radius: 40px; 
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-[1550px] mx-auto p-6 md:p-10">
    <div v-if="ui.showLibraryMenu" class="overlay" @click="ui.showLibraryMenu = false"></div>

    <div class="flex flex-wrap justify-between items-center mb-8 gap-4 no-print bg-white/90 backdrop-blur-md p-5 rounded-2xl shadow-xl border border-white/50 relative">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-4">
                <button @click="saveRecipe" class="hover:text-purple-600 transition-colors" title="Download JSON"><i class="ph ph-floppy-disk text-2xl"></i></button>
                <button @click="$refs.fileInput.click()" class="hover:text-purple-600 transition-colors" title="Load from Computer"><i class="ph ph-folder-open text-2xl"></i></button>
                
                <button @click="toggleLibrary" class="hover:text-purple-600 transition-colors flex items-center gap-1" title="Recipe Library">
                    <i class="ph ph-books text-2xl"></i>
                    <span class="text-xs font-bold uppercase">Library</span>
                </button>
            </div>
            
            <input type="file" ref="fileInput" @change="loadRecipe" accept=".json" class="hidden">
        </div>

        <div v-if="ui.showLibraryMenu" class="library-dropdown p-6 animate-in fade-in zoom-in-95 duration-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-black uppercase text-slate-800 tracking-widest">Global Library</h3>
                <button @click="ui.showLibraryMenu = false" class="text-slate-400 hover:text-slate-600"><i class="ph ph-x text-xl"></i></button>
            </div>
            
            <div class="relative mb-4">
                <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input v-model="searchQuery" type="text" placeholder="Search your recipes..." 
                       class="w-full bg-slate-100 border-none rounded-xl py-3 pl-10 pr-4 text-sm focus:ring-2 focus:ring-purple-300 outline-none">
            </div>

            <div class="max-h-80 overflow-y-auto space-y-2 pr-1">
                <div v-if="loadingLibrary" class="text-center py-8">
                    <i class="ph ph-circle-notch animate-spin text-3xl text-purple-400"></i>
                </div>
                <button v-for="r in filteredLibrary" :key="r.path" @click="fetchFromGithub(r.path)" 
                        class="w-full text-left p-4 hover:bg-purple-50 rounded-xl text-sm font-bold text-slate-700 flex items-center justify-between group transition-all">
                    {{ r.name }}
                    <i class="ph ph-caret-right text-purple-300 group-hover:text-purple-600"></i>
                </button>
                <div v-if="!loadingLibrary && filteredLibrary.length === 0" class="text-xs text-center py-8 text-slate-400 italic">
                    No matching recipes found.
                </div>
            </div>
        </div>
    </div>

    <div class="card p-10 md:p-16 border border-white/50 relative">
        <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-12">
            <div class="w-20 h-20 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-500 text-4xl shadow-inner">
                <i :class="categories.find(c => c.name === selectedCategory)?.icon || 'ph ph-cooking-pot'"></i>
            </div>
            <div class="flex flex-col">
                <span class="text-purple-400 font-bold uppercase tracking-[0.2em] text-xs ml-1">Recipe for...</span>
                <input v-model="recipeTitle" placeholder="Untitled Recipe" class="text-5xl font-black w-full focus:outline-none border-b-2 border-transparent focus:border-purple-300 pb-2 transition-all bg-transparent">
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div class="space-y-10">
                <section class="app-section">
                    <h2 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-6 border-b pb-3">Ingredients</h2>
                    <div v-for="ing in ingredients" :key="ing.id" class="flex items-center gap-4 mb-3">
                        <div class="w-16 text-right font-mono font-bold text-purple-600">{{ calculateAmount(ing.amount) }}</div>
                        <div class="w-12 text-xs font-black text-slate-800 uppercase">{{ ing.unit }}</div>
                        <input v-model="ing.name" placeholder="Ingredient..." class="flex-grow text-base outline-none bg-transparent">
                    </div>
                    <button @click="addIngredient" class="mt-4 text-purple-600 text-xs font-black no-print">+ ADD ITEM</button>
                </section>
            </div>

            <section class="app-section">
                <h2 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-6 border-b pb-3">Method</h2>
                <div v-for="(step, index) in method" :key="step.id" class="flex gap-4 mb-6 items-start">
                    <span class="text-3xl font-black text-slate-200 mt-1 w-8">{{ index + 1 }}</span>
                    <textarea v-model="step.text" rows="2" class="flex-grow text-base leading-relaxed p-4 bg-white/50 rounded-xl outline-none resize-none"></textarea>
                </div>
                <button @click="addMethod" class="text-purple-600 text-xs font-black no-print">+ ADD STEP</button>
            </section>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

// UPDATE THESE
const GITHUB_USERNAME = 'icheong'; 
const REPO_NAME = 'my-recipes';

createApp({
    data() {
        return {
            recipeTitle: '',
            searchQuery: '',
            scale: 1,
            selectedCategory: 'Mains',
            library: [],
            loadingLibrary: false,
            ui: { showLibraryMenu: false },
            categories: [{ name: 'Mains', icon: 'ph ph-cooking-pot' }],
            ingredients: [{ id: 1, amount: 0, unit: 'g', name: '' }],
            method: [{ id: 3, text: '' }]
        }
    },
    computed: {
        filteredLibrary() {
            if (!this.searchQuery) return this.library;
            return this.library.filter(r => r.name.toLowerCase().includes(this.searchQuery.toLowerCase()));
        }
    },
    methods: {
        toggleLibrary() {
            this.ui.showLibraryMenu = !this.ui.showLibraryMenu;
            if (this.ui.showLibraryMenu) this.fetchManifest();
        },
        async fetchManifest() {
            this.loadingLibrary = true;
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/recipes.json?t=${Date.now()}`);
                this.library = await response.json();
            } catch (e) { console.error(e); }
            finally { this.loadingLibrary = false; }
        },
        async fetchFromGithub(path) {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${path}`);
                const data = await response.json();
                Object.assign(this, data);
                this.ui.showLibraryMenu = false;
                this.searchQuery = '';
            } catch (e) { alert("Error loading file."); }
        },
        saveRecipe() {
            const data = JSON.stringify(this.$data);
            const blob = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${this.recipeTitle.replace(/\s+/g, '_') || 'recipe'}.json`;
            a.click();
        },
        loadRecipe(e) {
            const reader = new FileReader();
            reader.onload = (event) => Object.assign(this, JSON.parse(event.target.result));
            reader.readAsText(e.target.files[0]);
        },
        addIngredient() { this.ingredients.push({ id: Date.now(), amount: 0, unit: 'g', name: '' }); },
        addMethod() { this.method.push({ id: Date.now(), text: '' }); },
        calculateAmount(base) {
            let val = (parseFloat(base) || 0) * this.scale;
            return val === 0 ? '' : val.toFixed(1).replace('.0', '');
        }
    }
}).mount('#app');
</script>
</body>
</html>
